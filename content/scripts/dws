#!/bin/bash
# DeepWorkspace CLI - Main command dispatcher
# Usage: dws <command> [options]

set -e

# Get the directory where this script is located
SCRIPT_DIR="$(cd "$(dirname "${BASH_SOURCE[0]}")" && pwd)"
DWS_LIB="$SCRIPT_DIR/dws-lib"

# Source common functions
source "$DWS_LIB/common.sh"

# Main command dispatcher
case "${1:-}" in
    create)
        shift
        source "$DWS_LIB/create.sh"
        ;;
    start)
        shift
        source "$DWS_LIB/start.sh"
        ;;
    validate)
        shift
        source "$DWS_LIB/validate.sh"
        ;;
    fix)
        shift
        source "$DWS_LIB/fix.sh"
        ;;
    pr)
        shift
        source "$DWS_LIB/pr.sh" "$@"
        ;;
    help|--help|-h|"")
        cat << EOF
DeepWorkspace CLI v1.0.0

Usage: dws <command> [options]

Commands:
  create     Create a new project in the workspace
  start      Navigate to a project and open Claude Desktop
  validate   Check project compliance with workspace rules
  fix        Automatically fix common validation issues
  pr         Manage pull request workflow (create, merge, status)
  help       Show this help message

Examples:
  dws create              # Interactive project creation
  dws start               # Select and navigate to a project
  dws validate            # Check all projects for rule compliance
  dws fix                 # Auto-fix common issues
  dws pr create -t "title" # Create PR from current branch
  dws pr merge            # Merge PR and complete workflow
  dws help                # Show help

More commands coming soon:
  archive    Archive old projects
  protect    Toggle write protection on files

For more information, see the workspace README.md
EOF
        ;;
    *)
        echo "Error: Unknown command '$1'"
        echo "Run 'dws help' for usage information"
        exit 1
        ;;
esac